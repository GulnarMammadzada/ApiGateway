<!DOCTYPE html>
<html>
<head>
    <title>Registration Debug Test</title>
</head>
<body>
<h1>Registration Test</h1>
<button onclick="testRegistration()">Test Registration</button>
<div id="output"></div>

<script>
    async function testRegistration() {
        const output = document.getElementById('output');
        output.innerHTML = '<p>Testing registration...</p>';

        const testData = {
            username: 'testuser123',
            email: 'test@example.com',
            password: 'password123'
        };

        console.log('=== FRONTEND DEBUG START ===');
        console.log('Sending data:', testData);
        console.log('URL:', 'http://localhost:8080/api/auth/register');

        try {
            const response = await fetch('http://localhost:8080/api/auth/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify(testData)
            });

            console.log('=== RESPONSE RECEIVED ===');
            console.log('Status:', response.status);
            console.log('Status Text:', response.statusText);
            console.log('Headers:', Object.fromEntries(response.headers.entries()));
            console.log('OK:', response.ok);

            // Get response as text first
            const responseText = await response.text();
            console.log('Response Text:', responseText);

            let responseData;
            try {
                responseData = JSON.parse(responseText);
                console.log('Parsed JSON:', responseData);
            } catch (parseError) {
                console.error('JSON Parse Error:', parseError);
                responseData = { error: 'Invalid JSON response', raw: responseText };
            }

            output.innerHTML = `
                    <h3>Response Details:</h3>
                    <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
                    <p><strong>OK:</strong> ${response.ok}</p>
                    <p><strong>Headers:</strong></p>
                    <pre>${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}</pre>
                    <p><strong>Response Body:</strong></p>
                    <pre>${JSON.stringify(responseData, null, 2)}</pre>
                    <p><strong>Raw Response:</strong></p>
                    <pre>${responseText}</pre>
                `;

        } catch (error) {
            console.error('=== FETCH ERROR ===');
            console.error('Error type:', error.name);
            console.error('Error message:', error.message);
            console.error('Full error:', error);

            output.innerHTML = `
                    <h3>Error Details:</h3>
                    <p><strong>Error Type:</strong> ${error.name}</p>
                    <p><strong>Error Message:</strong> ${error.message}</p>
                    <p><strong>Full Error:</strong></p>
                    <pre>${JSON.stringify(error, Object.getOwnPropertyNames(error), 2)}</pre>
                `;
        }

        console.log('=== FRONTEND DEBUG END ===');
    }
</script>
</body>
</html>